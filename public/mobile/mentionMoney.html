<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>提币</title>
        <link rel="stylesheet" type="text/css" href="element-ui/lib/theme-chalk/index.css" />
        <link rel="stylesheet" href="css/common.css" />
        <link rel="stylesheet" href="javascripts/common.js" />
        <script>
            function code(result) {
                $('.address').val(result);
            }
            // function scaned(t, r, f){
            //     // alert(r);
            //     $('.address').val(r);
            // }
        </script>
    </head>
    <style>
        .bline {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }

        .mt30 {
            margin-top: 30px;
        }

        .color1b {
            color: #728daf;
        }

        .mention {
            width: 100%;
            height: 50px;
            line-height: 50px;
            color: #fff;
            background: #588bf7;
            border-radius: 30px;
            font-size: 20px;
        }

        .addbox img {
            width: 20px;
        }

        .addbox span {
            padding: 0 5px;
        }

        input {
            background-color: rgba(0, 0, 0, 0);
        }
        .address {
            width: 90%;
        }
        .tibi-biz {
            margin-bottom: 10px;
        }
        .tibi-biz h1 {
            font-size: 18px;
            color: #1c1d31;
        }
        .selectbiz .el-dropdown {
            width: 100%;
        }
        .selectbiz .el-dropdown-link {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }
        .selectbiz {
            padding: 10px 3%;
            border-radius: 5px;
            border: 1px solid #dcdfe6;
        }
        .tibi-address input {
            width: 100%;
            padding: 10px 3%;
            background: #f7f7fa;
        }
        .tibi-sl {
            width: 100%;
            padding: 10px 3%;
            background: #f7f7fa;
        }
        .all_in {
            color: #91a0be;
        }
        .tibi-balance {
            color: #8d9dbc;
            margin-top: 10px;
            display: flex;
            flex-direction: row;
        }
        .tibi-fee {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            width: 100%;
            padding: 10px 3%;
            background: #f7f7fa;
        }
    </style>

    <body class="bgWhite">
        <div id="app" v-cloak>
            <header class="header">
                <a class="back mt5" href="javascript:history.go(-1)"></a>
                <h4 class="ft16" data-localize="assets.tmoney">Withdraw</h4>
            </header>
            <div class="plr15 ft14 mt20">
                <!--<div class="ft20"><span class="title">USDT</span>-->
                <!--     <span data-localize="assets.tmoney">提币</span> -->
                <!--</div>-->
                <div class="tibi-biz">
                    <h1 data-localize="zdy.tibibizhong">Withdrawal currency</h1>
                </div>
                <div class="selectbiz">
                    <el-dropdown trigger="click" @command="selectedCurrency">
                        <span class="el-dropdown-link">
                            {{value3}}
                            <i class="el-icon-arrow-down el-icon--right"></i>
                        </span>
                        <el-dropdown-menu slot="dropdown">
                            <el-dropdown-item v-for="item in list" :key="item.id" :command="item">{{item.texts}}</el-dropdown-item>
                        </el-dropdown-menu>
                    </el-dropdown>
                </div>
                <div class="tibi-biz mt20">
                    <h1 data-localize="index.address">Withdrawal address</h1>
                </div>
                <div class="tibi-address">
                    <input type="text" data-localize="assets.padd" placeholder="Enter or long press paste address" class="ft14 address" />
                </div>
                <div class="tibi-biz mt20">
                    <h1 data-localize="zdy.tibishuliang">Withdraw amount</h1>
                </div>
                <div class="tibi-sl">
                    <div class="flex between alcenter">
                        <input type="number" v-model="balance" data-localize="contract.minimum" placeholder="Minimum withdrawal amount" class="ft14 count" />
                        <div>
                            <span class="white_gray title">USDT</span>
                            <span class="">|</span>
                            <span class="all_in" data-localize="deals.all">All</span>
                        </div>
                    </div>
                </div>
                <div class="tibi-balance">
                    <p data-localize="assets.avaiable">Available</p>
                    <p class="ft14">
                        <span class="balance-num">0.00</span>
                        <span class="title">USDT</span>
                    </p>
                </div>
                <!--<div class="bline mt30">-->
                <!--    <p data-localize="index.address">提币地址</p>-->
                <!--    <div class="flex between alcenter mt20">-->
                <!--        <input type="text" data-localize="assets.padd" placeholder="输入或长按粘贴地址" class="ft14 address">-->
                <!-- <div class="color3 flex alcenter addbox">
        <!--            <img src="images/ercode.png" alt="" onclick="clicked('barcode_scan.html',true,true)">-->
                <!--            <img src="images/ercode.png" alt="" onclick="BSL.Qcode('0','code')">-->
                <!--            <span>|</span>-->
                <!--            <img src="images/choose.png" alt="">-->
                <!--        </div> -->
                <!--    </div>-->
                <!--</div>-->
                <!--<div class="bline mt30">-->
                <!--    <p data-localize="assets.num">数量</p>-->
                <!--    <div class="flex between alcenter mt20">-->
                <!--        <input type="number" data-localize="contract.minimum" placeholder="最小提币数量" class="ft14 count">-->
                <!--        <div>-->
                <!--            <span class="white_gray title">USDT</span>-->
                <!--            <span class="">|</span>-->
                <!--            <span class=" bold all_in" data-localize="deals.all">全部</span>-->
                <!--        </div>-->
                <!--    </div>-->
                <!--</div>-->
                <div class="tibi-biz mt20">
                    <h1 data-localize="deals.fee">Service Charge</h1>
                </div>
                <div class="tibi-fee">
                    <span data-localize="deals.fee" style="color: #b9b9b9">Service Charge</span>
                    <article>
                        <span class="ratenum" style="color: #62759a">{{iTofixed(balance * 0.01, 2)}}</span>
                        <span class="title" style="color: #62759a">USDT</span>
                    </article>
                </div>
                <div class="tibi-biz mt20">
                    <h1 data-localize="assets.dnum">Number of accounts arrived</h1>
                </div>
                <div class="tibi-fee">
                    <span data-localize="assets.dnum" style="color: #b9b9b9">Number of accounts arrived</span>
                    <article>
                        <span class="reach-num" style="color: #62759a">0.0000</span>
                        <span class="title" style="color: #62759a">USDT</span>
                    </article>
                </div>
                <!--<div class="flex between alcenter ft14 mt20">-->
                <!--    <p data-localize="assets.dnum">到账数量</p>-->
                <!--    <p class="bold  ft14"><span class="reach-num">0.0000</span> <span class="title  bold">USDT</span></p>-->
                <!--</div>-->
                <div class="mention tc ft14 mt20" data-localize="assets.tmoney">Withdraw</div>
            </div>
        </div>
        <script type="text/javascript" src="lib/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="javascripts/jquery.cookie.js"></script>
        <script type="text/javascript" src="lib/layer_mobile/layer.js"></script>
        <script type="text/javascript" src="lib/jquery.localize.min.js"></script>
        <script type="text/javascript" src="lib/language_cookie.js"></script>
        <script type="text/javascript" src="javascripts/main.js"></script>
        <script type="text/javascript" src="javascripts/immersed.js"></script>
        <script type="text/javascript" src="lib/vue.min.js"></script>
        <script type="text/javascript" src="element-ui/lib/index.js"></script>
        <script>
            new Vue({
                el: '#app',
                data: {
                    list: [],
                    value3: '',
                    balance: '',
                },
                mounted() {
                    this.init();
                },
                methods: {
                    selectedCurrency(command) {
                        this.value3 = command.texts;
                        $('.title').html(command.texts);
                        $('.count').val('');
                        $('.reach-num').html('0.00');
                        initDataToken(
                            {
                                type: 'post',
                                url: 'wallet/get_info',
                                data: {
                                    currency: command.currency,
                                },
                            },
                            function (res) {
                                balance = res.change_balance;
                                rate = res.rate;
                                $('.balance-num').html(iTofixed(balance, 4));
                                // $('.ratenum').html(res.rate);
                                // $('.ratenum').html('0');
                            }
                        );
                    },
                    init() {
                        let that = this;
                        initDataToken(
                            {
                                url: 'wallet/list',
                                type: 'POST',
                            },
                            function (res) {
                                // if (res.legal_wallet.balance) {
                                //     let data = res.legal_wallet.balance;
                                //     for (let i = 0; i < data.length; i++) {
                                //         if (data[i].is_legal == 1) {
                                //             if (get_param('id') == data[i].currency) {
                                //                 that.value3 = data[i].currency_name;
                                //             }
                                //             that.list.push({ currency: data[i].currency, balance: data[i].legal_balance, texts: data[i].currency_name });
                                //             console.log(that.list);
                                //         }
                                //     }
                                // }
                                const {balance:data } = res.change_wallet
                                for (let i = 0; i < data.length; i++) {
                                    if(~~data[i].change_balance){
                                        if (get_param('id') == data[i].currency) {
                                            that.value3 = data[i].currency_name;
                                        }
                                        that.list.push({ 
                                            currency: data[i].currency,
                                            balance: data[i].change_balance, 
                                            texts: data[i].currency_name
                                        });
                                    }
                                }
                            }
                        );
                    },
                },
            });
            $(function () {
                // FastClick.attach(document.body);
                var currency = get_param('id');
                var balance, min_number, rate;
                initDataToken(
                    {
                        url: 'wallet/get_info',
                        type: 'post',
                        data: {
                            currency,
                        },
                    },
                    function (res) {
                        balance = res.change_balance;
                        $('.balance-num').html(iTofixed(balance, 4));
                        $('.title').html(res.name);
                        rate = res.rate;
                        // $('.ratenum').html(rate);
                        // $('.ratenum').html(0);
                        min_number = res.min_number;
                        $('.count').attr('placeholder', getlg('minimum') + iTofixed(min_number, 2));
                        var num = 0;
                        $('.reach-num').html(iTofixed(num, 2));
                    }
                );

                function postData() {
                    var address = $('.address').val();
                    var number = $('.count').val();
                    initDataTokenNo({
							url: "microtrade/lists",
							data: {
								page: 1,
								status: 1,
								limit: 20,
							}
						}, function(res) {
                            
							if(res.type !== 'ok') return
                            const {data} = res.message;
                            if(data.length) return layer_msg(getlg('youStillHaveUnfinishedOrders'));
                            if (!address)  return  layer_msg(getlg('withdrawalAddress'));
                            if (!number)return layer_msg(getlg('withdrawalAmount'));
                            if (number - 0 < min_number)  return layer_msg(getlg('withdrawals'));
                            layer_loading();
                            initDataToken(
                                {
                                    url: 'wallet/out',
                                    type: 'post',
                                    data: {
                                        currency,
                                        number,
                                        rate,
                                        address,
                                    },
                                },
                                function (res) {
                                    layer_msg(res);
                                    setTimeout(() => {
                                        window.location.href = document.referrer;
                                        // location.href = 'matchAccount.html?id=' + currency + '&type=2';
                                    }, 1500);
                                }
                            );
                            // var token = get_user_login();
                            // $.ajax({
                            //     url: _API + 'user/info',
                            //     type: 'GET',
                            //     dataType: 'json',
                            //     async: true,
                            //     beforeSend: function beforeSend(request) {
                            //         request.setRequestHeader('Authorization', token);
                            //     },
                            //     success: function success(_) {
                            //         // auth_low 初级认证0=未认证；1=已认证；2=审核中
                            //         const {auth_low, auth_high } = _.message
                            //         switch (auth_low) {
                            //             case 0:
                            //                 // 如果未认证要跳到初级认证页面
                            //                 return  location.href = 'userCertificationFirst.html';
                            //             case 2:
                            //                 return layer_msg(getlg('primaryCertificationReview'))
                            //             default:
                            //                 break;
                            //         }
                            //         // auth_high 高级认证0=未认证；1=已认证；2=审核中
                            //         switch (auth_high) {
                            //             case 0:
                            //                 // 如果未认证要跳到高级认证页面
                            //                 return  location.href = 'advancedCertification.html';
                            //             case 2:
                            //                 return layer_msg(getlg('advancedCertificationIsUnderReview'))
                            //             default:
                            //                 break;
                            //         }

                            //         initDataToken(
                            //             {
                            //                 url: 'wallet/out',
                            //                 type: 'post',
                            //                 data: {
                            //                     currency,
                            //                     number,
                            //                     rate,
                            //                     address,
                            //                 },
                            //             },
                            //             function (res) {
                            //                 layer_msg(res);
                            //                 setTimeout(() => {
                            //                     location.href = 'matchAccount.html?id=' + currency + '&type=2';
                            //                 }, 1500);
                            //             }
                            //         );
                                    
                            //     },
                            // });
                            

						})
                }
                $('.mention').click(function () {
                    postData();
                });
                $('.all_in').click(function () {
                    $('.count').val(balance);
                    //console.log(balance);
                    // var num = iTofixed(balance - rate, 2);
                    var num = iTofixed(balance - balance * 0.01, 2);
                    if (num > 0) {
                        $('.reach-num').html(num);
                        $('.ratenum').html(balance * 0.01);
                    } else {
                        $('.reach-num').html('0.00');
                    }
                });
                $('.count').keyup(function () {
                    var value = $(this).val();
                    // var num = iTofixed(value - rate, 2);
                    var num = iTofixed(value - value * 0.01, 2);
                    if (num > 0) {
                        $('.reach-num').html(num);
                    } else {
                        $('.reach-num').html('0.00');
                    }
                });
            });
        </script>
    </body>
</html>
